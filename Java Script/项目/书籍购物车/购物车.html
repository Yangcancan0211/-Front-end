<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    table {
      border-collapse: collapse;
    }

    thead {
      background-color: #f5f5f5;
    } 

    td, th {
      border: 1px solid #ddd;
      padding: 8px 15px;
      text-align: center;
    }
  </style>
</head>
<body>
  <table>
    <thead>
      <tr>
        <th>编号</th>
        <th>书籍名称</th>
        <th>出版日期</th>
        <th>价格</th>
        <th>购买数量</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
  <h2>总价格: <span class="total-price"></span> </h2>
  <script>
    //1.从服务器获取数据 ajax/fetch
    var books = [
      {
        id: 1,
        name: '《算法导论》',
        date: '2006-09',
        price: 85.00,
        count: 3
      },
      {
        id: 2,
        name: '《UNIX编程艺术》',
        date: '2006-02',
        price: 59.00,
        count: 2
      },
      {
        id: 3,
        name: '《编程珠玑》',
        date: '2008-10',
        price: 39.00,
        count: 5
      },
      {
        id: 4,
        name: '《代码大全》',
        date: '2006-03',
        price: 128.00,
        count: 8
      },
    ]
     //2.对数据的展示
     //1>对于固定的数据,直接通过html编写
     //2>对于大量的数据,有规律的数据,可以通过js编写
      var tbodyEl = document.querySelector("tbody")
    //  2.1动态添加tr及内部的数据
    for (var i = 0;i < books.length;i++){
        var trEl = document.createElement("tr")
        //2.2 放具体的数据
        var book = books[i]
        var bookKeys = Object.keys(book)
        for (var m = 0; m < bookKeys.length; m++) {
            var key = bookKeys[m]
            var value = book[key]
            if (key === "price"){
               value = "¥" + value
            }
            var tdEl = document.createElement("td")
            tdEl.textContent = value
            trEl.append(tdEl)
        }
        tbodyEl.append(trEl)
        //2.3 添加删除按钮
        var deleteTdEl = document.createElement("td")
        var deleteBtnEl = document.createElement("button")
        deleteBtnEl.textContent = "删除"
        deleteTdEl.append(deleteBtnEl)
        trEl.append(deleteTdEl)
        tbodyEl.append(trEl)
         //2.4.点击删除,重新计算价格
        deleteBtnEl.onclick = function() {
            //1.删除对应的tr
            var deleteTrEl = this.parentElement.parentElement
            //2.1获取索引
            var index = deleteTrEl.sectionRowIndex
            deleteTrEl.remove()
            //2.删除对应books中对应的数据 
            books.splice(index,1)
            //3.重新计算价格
            calcTotalPrice()
        }
        //2.5动态计算总价格
        var totalPriceEl = document.querySelector(".total-price")
        calcTotalPrice()
        //方案一: 直接遍历数组,累加计算
        // var totalPrice = 0
        // for(var i = 0;i < books.length;i++){
        //     var book = books[i]
        //     totalPrice += book.price * book.count
        // }
       //方案二: 利用数组的reduce方法
       
       
   }
   //封装计算价格的函数
     function calcTotalPrice() {
         var totalPrice = books.reduce(function(pre,book){
            return pre + book.price * book.count
        },0)
        totalPriceEl.textContent = "¥" + totalPrice
     }
 </script>
</body>
</html>